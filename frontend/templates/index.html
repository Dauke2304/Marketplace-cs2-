<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{.CSRFToken}}">
    <title>Main page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="styleTemplates/index.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
</head>

<body>
    <header class="bg-dark py-3 text-center">
        <h1 class="text-success">
            CS <a href="/main" class="highlight-link">Marketplace</a>
        </h1>
        <nav class="nav justify-content-center">
            <a class="nav-link text-white" href="/home">Home</a>
            <a class="nav-link text-white" href="/profile">Profile</a>
            <a class="nav-link text-white" href="/about">About</a>
            <a class="nav-link text-white" href="/contact">Contact</a>
        </nav>
    </header>

    <main class="container my-5">
        <div class="d-flex justify-content-between mb-3">
            <input type="text" id="searchInput" class="form-control w-50" onkeyup="searchItems()" placeholder="Search for items..." />
            <div>
                <button class="btn btn-outline-light" onclick="sortItemsByPrice()">Sort by Price</button>
                <button class="btn btn-outline-light" onclick="sortItemsByName()">Sort by Name (A-Z)</button>
            </div>
        </div>

        <div id="item-container" class="row row-cols-1 row-cols-md-3 g-4 justify-content-center">
            {{range .Items}}
            <div class="col item-card" data-price="{{.Price}}">
              <div class="card bg-dark text-white shadow">
                  <img src="{{.Image}}" class="card-img-top" alt="{{.Name}}">
                  <div class="card-body text-center">
                      <h5 class="card-title">{{.Name}}</h5>
                      <p class="card-text">Price: ${{.Price}}</p>
                      <form action="/buy-skin" method="POST">
                        <input type="hidden" name="skinID" value="{{.ID}}">
                        <button type="submit" class="btn btn-success">Buy Now</button>
                    </form>
                  </div>
              </div>
          </div>
          
            {{else}}
            <p>No items available.</p>
            {{end}}
        </div>
  
    </main>
    <script>
document.querySelectorAll("form").forEach(form => {
    form.addEventListener("submit", function (event) {
        event.preventDefault(); 

        const formData = new FormData(form);
        const data = { skinID: formData.get("skinID") };
        console.log("Отправляемые данные:", [...formData]); 
        const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content'); 

        fetch(form.action, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRF-Token": csrfToken
            },
            body: JSON.stringify(data)
        })
        .then(response => response.text())
        .then(data => {
            console.log("Ответ сервера:", data);
            try {
                const jsonData = JSON.parse(data);
                if (jsonData.error) {
                    alert(jsonData.error); // Если есть ошибка, показываем её
                } else {
                    alert("Confirm action"); // Если ошибки нет, показываем "Confirm action"
                }
            } catch (error) {
                console.error("Ошибка разбора JSON:", error);
                alert("Confirm action ", error);
            }
        })
        .catch(error => console.error("Ошибка:", error));
    });
});



    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    
</body>
</html>
